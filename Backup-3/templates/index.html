<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Work Session Monitor</title>
  <style>
    /* (Gi·ªØ nguy√™n to√†n b·ªô ph·∫ßn CSS b·∫°n ƒë√£ vi·∫øt r·∫•t ƒë·∫πp, kh√¥ng thay ƒë·ªïi g√¨) */
    /* ... gi·ªØ nguy√™n to√†n b·ªô ph·∫ßn style ... */
  </style>
</head>
<body>
  <div class="container">
    <h1>Work Session Monitor</h1>

    <div class="button-group">
      <button id="startBtn">
        <span class="icon">‚ñ∂Ô∏è</span>Start Work
      </button>
      <button id="stopBtn" disabled>
        <span class="icon">‚èπÔ∏è</span>Stop Work
      </button>
      <button id="checkBtn">
        <span class="icon">üìè</span>Check Distance
      </button>
      <button id="historyBtn" onclick="window.location.href='/history'">
        <span class="icon">üìä</span>View History
      </button>
    </div>

    <div class="status-card">
      <div id="status">Ready to start work session</div>
    </div>

    <div class="distance-card">
      <div id="distance">Click "Check Distance" to measure</div>
    </div>
  </div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const checkBtn = document.getElementById('checkBtn');
    const statusDiv = document.getElementById('status');
    const distanceDiv = document.getElementById('distance');

    const SAFE_DISTANCE = 50; // cm

    startBtn.onclick = function () {
      fetch('/start_work', { method: 'POST' })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            statusDiv.innerHTML = `<span class="icon">‚úÖ</span>Work started at ${data.start_time}`;
            startBtn.disabled = true;
            stopBtn.disabled = false;
          } else {
            statusDiv.innerHTML = `<span class="icon">‚ùå</span>${data.error}`;
          }
        });
    };

    stopBtn.onclick = function () {
      fetch('/stop_work', { method: 'POST' })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            statusDiv.innerHTML = `<span class="icon">‚èπÔ∏è</span>Work stopped. Duration: ${data.duration}, Avg Distance: ${data.avg_distance}`;
            startBtn.disabled = false;
            stopBtn.disabled = true;
          } else {
            statusDiv.innerHTML = `<span class="icon">‚ùå</span>${data.error}`;
          }
        });
    };

    checkBtn.onclick = function () {
      fetch('/check_distance')
        .then((res) => res.json())
        .then((data) => {
          if (data.distance > 0) {
            const distance = parseFloat(data.distance);
            const warning = distance < SAFE_DISTANCE;

            const warningClass = warning ? ' warning' : '';
            const warningIcon = warning ? '‚ö†Ô∏è' : '‚úÖ';
            distanceDiv.innerHTML = `<span class="icon">${warningIcon}</span><span class="${warningClass}">Current Distance: ${distance.toFixed(1)}cm${warning ? ' (Too Close!)' : ''}</span>`;

            // G·ª≠i d·ªØ li·ªáu distance v·ªÅ server
            fetch('/add_distance', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ distance: distance })
            });

            // G·ª≠i c·∫£nh b√°o n·∫øu qu√° g·∫ßn
            if (warning) {
              fetch('/add_break_warning', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
              });
            }
          } else {
            distanceDiv.innerHTML = '<span class="icon">‚ùå</span>No distance data.';
          }
        });
    };
  </script>
</body>
</html>